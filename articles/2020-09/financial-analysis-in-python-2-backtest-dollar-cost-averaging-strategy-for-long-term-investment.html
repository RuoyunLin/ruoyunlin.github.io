<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="OverviewThis is the second blog post of my Finaical Analysis in Python series.This blog series covers topics like the following:  how to visualize the long-t...">
  <meta name="keywords" content="Data Analyst, Data Scientist, User Researcher, Quantitative Research, and Business Analyst">
  <meta name="author" content="Financial Analysis in Python #2: Backtest Dollar Cost Averaging Strategy for Long-term Investment | Ruoyun Lin's Blog">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f5f5f5">

  <!-- Twitter Tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Financial Analysis in Python #2: Backtest Dollar Cost Averaging Strategy for Long-term Investment | Ruoyun Lin's Blog">
  <meta name="twitter:description" content="OverviewThis is the second blog post of my Finaical Analysis in Python series.This blog series covers topics like the following:  how to visualize the long-t...">
  <meta name="twitter:image" content="https://RuoyunLin.github.io/img/leonids-logo.png">

  <!-- Open Graph Tags -->
  <meta property="og:type" content="blog">
  <meta property="og:url" content="https://RuoyunLin.github.io">
  <meta property="og:title" content="Financial Analysis in Python #2: Backtest Dollar Cost Averaging Strategy for Long-term Investment | Ruoyun Lin's Blog">
  <meta property="og:description" content="OverviewThis is the second blog post of my Finaical Analysis in Python series.This blog series covers topics like the following:  how to visualize the long-t...">
  <meta property="og:image" content="https://RuoyunLin.github.io/img/leonids-logo.png">
  <title>Financial Analysis in Python #2: Backtest Dollar Cost Averaging Strategy for Long-term Investment | Ruoyun Lin's Blog</title>

  <!-- CSS files -->
  <link rel="stylesheet" href="https://RuoyunLin.github.io/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://RuoyunLin.github.io/css/main.css">

  <link rel="canonical" href="https://RuoyunLin.github.io/articles/2020-09/financial-analysis-in-python-2-backtest-dollar-cost-averaging-strategy-for-long-term-investment">
  <link rel="alternate" type="application/rss+xml" title="Ruoyun Lin's Blog" href="https://RuoyunLin.github.io /feed.xml " />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="https://RuoyunLin.github.io/favicon.ico">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="https://RuoyunLin.github.io/favicon.png">
</head>


<body>
  <div class="row">
    <div class="col s12 m3">
      <div class="table cover">
        

<div class="cover-card table-cell table-middle">
  
  <img src="https://RuoyunLin.github.io/img/avatar.jpg" alt="" class="avatar">
  
  <a href="https://RuoyunLin.github.io/" class="author_name">Ruoyun Lin</a>
  <span class="author_job"> </span>
  <span class="author_bio mbm">Data scientist lead at trivago, Germany</span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="https://RuoyunLin.github.io/">home</a>
        <span>/</span>
      </li>
         
      <li class="nav-item">
        <a href="https://RuoyunLin.github.io/about/">About</a>
        
          <span>/</span>
        
      </li>
        
      <li class="nav-item">
        <a href="https://RuoyunLin.github.io/archive/">Archive</a>
        
          <span>/</span>
        
      </li>
          
      <li class="nav-item">
        <a href="https://RuoyunLin.github.io/categories/">Categories</a>
        
          <span>/</span>
        
      </li>
            
      <li class="nav-item">
        <a href="https://RuoyunLin.github.io/tags/">Tags</a>
        
          <span>/</span>
        
      </li>
           
    </ul>
  </nav>
  <script type="text/javascript">
  // based on http://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
</script>
<div class="social-links">
  <ul>
    
      <li>
      <script>gen_mail_to_link('ritalinruoyun@gmail.com', 'Hello from website');</script>
      </li>
    
    <li><a href="http://twitter.com/RuoyunLin" class="social-link-item" target="_blank"><i class="fa fa-fw fa-twitter"></i></a></li>
    
    
    
    
    
    
    <li><a href="http://github.com/RuoyunLin" class="social-link-item" target="_blank"><i class="fa fa-fw fa-github"></i></a></li>
    
    
    
    
    
    
    
    
    
    
    
    
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m9">
      <div class="post-listing">
        <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<a class="btn" href= "https://RuoyunLin.github.io/" >
  Home
</a>



<div id="post">
  <header class="post-header">
    <h1 title="Financial Analysis in Python #2: Backtest Dollar Cost Averaging Strategy for Long-term Investment">Financial Analysis in Python #2: Backtest Dollar Cost Averaging Strategy for Long-term Investment</h1>
    <span class="post-meta">
      <span class="post-date">
        13 SEP 2020
      </span>
      â€¢
      <span class="read-time" title="Estimated read time">
  
  
    17 mins read
  
</span>

    </span>

  </header>

  <article class="post-content">
    <h1 id="overview">Overview</h1>

<p>This is the second blog post of my <strong>Finaical Analysis in Python</strong> series.</p>

<p>This blog series covers topics like the following:</p>

<ul>
  <li>how to <strong>visualize</strong> the <strong>long-term</strong> investment plan</li>
  <li>backtest <strong>dollar-cost averaging</strong> strategy for <strong>long-term</strong> investment</li>
  <li>backtest <strong>value averaging</strong> strategy for <strong>long-term</strong> investment</li>
  <li>compare different investment strategies for <strong>short-term</strong> investment</li>
</ul>

<!--more-->

<p>The jupyter notebooks can be downloaded <a href="https://github.com/RuoyunLin/code_snippets/tree/master/finance">here</a>.</p>

<h1 id="disclaimer">Disclaimer</h1>

<p>Investing money into anything is often involved with risk. Please do your own research before investing and be responsible for your own investment decisions.</p>

<p>I am just learning investment on my own and want to share some codes that I have written that might be useful for others.</p>

<p>The content here is only for informational purpose (instead of taking them as professional investment advice).</p>

<h1 id="introduction">Introduction</h1>

<p>In the last notebook, we already talked about how to visualize the return of a long term investment plan.</p>

<p>We made an assumption that the annual return rate is about 5%. How can we ensure that we can invest our savings properly so that we can have a 5% annual return?</p>

<p>In this notebook, we are going to use the historical data of SP500 to do some backtesting.</p>

<p>We will calculate the overall rate of return and the internal rate of return for two dollor cost averaging methods.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Import libraries
</span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">pandas_datareader</span> <span class="kn">import</span> <span class="n">data</span> <span class="k">as</span> <span class="n">pdr</span>

<span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="s">'bmh'</span><span class="p">)</span>
<span class="n">warnings</span><span class="p">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">"ignore"</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="a-peak-into-the-history">A peak into the history</h1>

<p>The first step here is to download data. I used a method introducted in a <a href="https://www.datacamp.com/community/tutorials/finance-python-trading">datacamp tutorial</a>.</p>

<p>The <a href="https://www.investopedia.com/terms/t/total_return_index.asp#:~:text=The%20total%20return%20index%20is,representation%20of%20the%20index's%20performance">total return index</a> of SP500 between 1988 and 2020 is used here.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get historical data
</span><span class="n">startdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1988</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">enddate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># SP 500 Total return index
</span><span class="n">SP</span> <span class="o">=</span> <span class="n">pdr</span><span class="p">.</span><span class="n">get_data_yahoo</span><span class="p">(</span><span class="s">'^SP500TR'</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">startdate</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">enddate</span><span class="p">)</span>

<span class="c1"># If you want to use the price index of SP500, you can use the ticker of '^GSPC'
# SP = pdr.get_data_yahoo('^GSPC', start=startdate, end=enddate)
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SP</span>
</code></pre></div></div>

<div>
<style>
table {
  border-collapse: collapse;
  width: 100%;
}

th, td {
  text-align: left;
  padding: 5px;
}

tr:nth-child(even) {background-color: #f2f2f2;}
</style>

<table>
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>High</th>
      <th>Low</th>
      <th>Open</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Adj Close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1988-01-04</th>
      <td>256.019989</td>
      <td>256.019989</td>
      <td>256.019989</td>
      <td>256.019989</td>
      <td>0</td>
      <td>256.019989</td>
    </tr>
    <tr>
      <th>1988-01-05</th>
      <td>258.769989</td>
      <td>258.769989</td>
      <td>258.769989</td>
      <td>258.769989</td>
      <td>0</td>
      <td>258.769989</td>
    </tr>
    <tr>
      <th>1988-01-06</th>
      <td>259.029999</td>
      <td>259.029999</td>
      <td>259.029999</td>
      <td>259.029999</td>
      <td>0</td>
      <td>259.029999</td>
    </tr>
    <tr>
      <th>1988-01-07</th>
      <td>261.209991</td>
      <td>261.209991</td>
      <td>261.209991</td>
      <td>261.209991</td>
      <td>0</td>
      <td>261.209991</td>
    </tr>
    <tr>
      <th>1988-01-08</th>
      <td>243.550003</td>
      <td>243.550003</td>
      <td>243.550003</td>
      <td>243.550003</td>
      <td>0</td>
      <td>243.550003</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2020-08-17</th>
      <td>6954.669922</td>
      <td>6937.540039</td>
      <td>6940.890137</td>
      <td>6943.220215</td>
      <td>0</td>
      <td>6943.220215</td>
    </tr>
    <tr>
      <th>2020-08-18</th>
      <td>6971.020020</td>
      <td>6920.080078</td>
      <td>6954.689941</td>
      <td>6960.299805</td>
      <td>0</td>
      <td>6960.299805</td>
    </tr>
    <tr>
      <th>2020-08-19</th>
      <td>6981.410156</td>
      <td>6920.370117</td>
      <td>6967.069824</td>
      <td>6930.799805</td>
      <td>0</td>
      <td>6930.799805</td>
    </tr>
    <tr>
      <th>2020-08-20</th>
      <td>6963.520020</td>
      <td>6889.850098</td>
      <td>6901.520020</td>
      <td>6952.919922</td>
      <td>0</td>
      <td>6952.919922</td>
    </tr>
    <tr>
      <th>2020-08-21</th>
      <td>6982.970215</td>
      <td>6941.000000</td>
      <td>6954.390137</td>
      <td>6977.270020</td>
      <td>0</td>
      <td>6977.270020</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generate group by keys
</span><span class="n">SP</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">SP</span><span class="p">.</span><span class="n">index</span>
<span class="n">SP</span><span class="p">[</span><span class="s">'year'</span><span class="p">]</span> <span class="o">=</span> <span class="n">SP</span><span class="p">[</span><span class="s">'date'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">d</span><span class="p">.</span><span class="n">year</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="c1"># Group by year, take the adjusted close price of the first business day in each year
</span><span class="n">df</span> <span class="o">=</span> <span class="n">SP</span><span class="p">[[</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'Adj Close'</span><span class="p">]].</span><span class="n">sort_index</span><span class="p">().</span><span class="n">groupby</span><span class="p">(</span><span class="s">'year'</span><span class="p">).</span><span class="n">first</span><span class="p">()</span>

<span class="c1"># Generate annual return
</span><span class="n">df</span><span class="p">[</span><span class="s">'return'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'Adj Close'</span><span class="p">].</span><span class="n">pct_change</span><span class="p">()</span>

<span class="c1"># Show annual return by the beginning of next year
</span><span class="n">df</span><span class="p">[</span><span class="s">'return_next_y'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'return'</span><span class="p">].</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s">'return'</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">df</span>
</code></pre></div></div>

<div>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>Adj Close</th>
      <th>return_next_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1988</td>
      <td>256.019989</td>
      <td>0.115733</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1989</td>
      <td>285.649994</td>
      <td>0.351864</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1990</td>
      <td>386.160004</td>
      <td>-0.058836</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1991</td>
      <td>363.440002</td>
      <td>0.320273</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1992</td>
      <td>479.839996</td>
      <td>0.075358</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1993</td>
      <td>516.000000</td>
      <td>0.099031</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1994</td>
      <td>567.099976</td>
      <td>0.014848</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1995</td>
      <td>575.520020</td>
      <td>0.386954</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1996</td>
      <td>798.219971</td>
      <td>0.214014</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1997</td>
      <td>969.049988</td>
      <td>0.346721</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1998</td>
      <td>1305.040039</td>
      <td>0.278520</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1999</td>
      <td>1668.520020</td>
      <td>0.199932</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2000</td>
      <td>2002.109985</td>
      <td>-0.108011</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2001</td>
      <td>1785.859985</td>
      <td>-0.088109</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2002</td>
      <td>1628.510010</td>
      <td>-0.199778</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2003</td>
      <td>1303.170044</td>
      <td>0.241626</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2004</td>
      <td>1618.050049</td>
      <td>0.103155</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2005</td>
      <td>1784.959961</td>
      <td>0.075072</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2006</td>
      <td>1918.959961</td>
      <td>0.138075</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2007</td>
      <td>2183.919922</td>
      <td>0.040977</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2008</td>
      <td>2273.409912</td>
      <td>-0.340563</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2009</td>
      <td>1499.170044</td>
      <td>0.245396</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2010</td>
      <td>1867.060059</td>
      <td>0.145277</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2011</td>
      <td>2138.300049</td>
      <td>0.025300</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2012</td>
      <td>2192.399902</td>
      <td>0.171570</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2013</td>
      <td>2568.550049</td>
      <td>0.279590</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2014</td>
      <td>3286.689941</td>
      <td>0.146649</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2015</td>
      <td>3768.679932</td>
      <td>-0.001244</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2016</td>
      <td>3763.989990</td>
      <td>0.146411</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2017</td>
      <td>4315.080078</td>
      <td>0.218119</td>
    </tr>
    <tr>
      <th>30</th>
      <td>2018</td>
      <td>5256.279785</td>
      <td>-0.050553</td>
    </tr>
    <tr>
      <th>31</th>
      <td>2019</td>
      <td>4990.560059</td>
      <td>0.324358</td>
    </tr>
    <tr>
      <th>32</th>
      <td>2020</td>
      <td>6609.290039</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Describe the annual return
</span><span class="n">df</span><span class="p">[</span><span class="s">'return_next_y'</span><span class="p">].</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>
<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>count    32.000000
mean      0.120554
std       0.169035
min      -0.340563
25%       0.022687
50%       0.141676
75%       0.242569
max       0.386954
Name: return_next_y, dtype: float64
</code></pre></div></div>

<p>When checking the annual return rate, the minimum value is  -34.1% and maximum value is 38.7%.
So we should not be panic if we see a drop of 30-40% in the total value in a certain year. Try to buy more in the dip, and the bull market will follow in 1-3 years.</p>

<h1 id="define-functions">Define functions</h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">calc_dollar_cost_averaging_return</span><span class="p">(</span><span class="n">df_dc</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">value_per_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> 
                                      <span class="n">increase_investment_per_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                                      <span class="n">display_returns</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="s">"""
    This function calculates the overall rate of return and the internal rate of return of dollar cost averaging method. 
    :param df_dc: Original dataframe that contains the price at the beginning of each period
    :param value_per_period: Investment value per period
    :param increase_investment_per_period: Increase the investment by x each period
    :param display_returns: Whether to display return results or not
    :return: A dataframe that contains all the relevant info
    """</span>
    <span class="c1"># amount to invest each period
</span>    <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'should_invest'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_per_period</span>   
    <span class="c1"># total amount of investment after the investment this period
</span>    <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_per_period</span>   
    <span class="c1"># the total value by the beginning of next period
</span>    <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_per_period</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'return_next_y'</span><span class="p">])</span>
    <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'overall_return_next'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="p">.</span><span class="n">index</span><span class="p">)):</span>
        <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'should_invest'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_per_period</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">increase_investment_per_period</span><span class="p">)</span><span class="o">**</span><span class="n">i</span>
        <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'should_invest'</span><span class="p">]</span>
        <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span> <span class="o">+</span> 
                                            <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'should_invest'</span><span class="p">])</span> <span class="o">*</span>
                                            <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'return_next_y'</span><span class="p">])</span> 
                                           <span class="p">)</span>
        <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'overall_return_next'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        
    <span class="k">if</span> <span class="n">display_returns</span><span class="p">:</span>
        
        <span class="c1"># Calculate overall return
</span>        <span class="n">overall_return</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="p">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'overall_return_next'</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"The overall return rate is </span><span class="si">{</span><span class="n">overall_return</span><span class="si">}</span><span class="s">%"</span><span class="p">)</span>

        <span class="c1"># Calculate IRR
</span>        <span class="n">cf</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">df_dc</span><span class="p">[</span><span class="s">'should_invest'</span><span class="p">]).</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">cf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="p">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"The cash flow (the negative sign stands for investment):"</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
        <span class="n">irr</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">irr</span><span class="p">(</span><span class="n">cf</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"The internal return rate (IRR) is </span><span class="si">{</span><span class="n">irr</span><span class="si">}</span><span class="s">% per period"</span><span class="p">)</span>
        
        <span class="c1"># Calculate CAGR
</span>        <span class="n">cagr</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="p">((</span><span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="p">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'total_value_next'</span><span class="p">]</span><span class="o">/</span>
                           <span class="n">df_dc</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="p">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'total_invest'</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dc</span><span class="p">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"The compound annual growth rate (CAGR) is </span><span class="si">{</span><span class="n">cagr</span><span class="si">}</span><span class="s">% per period"</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">df_dc</span>


<span class="k">def</span> <span class="nf">plot_changes</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span>
                 <span class="n">y1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'total_invest'</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'total_value_next'</span><span class="p">,</span>
                 <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'period'</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'value'</span><span class="p">,</span>
                 <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">'Visualize total investment and value each year'</span><span class="p">,</span>
                 <span class="n">target</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="s">"""
    This function visualizes the total investment and the total value of the investment plan across time
    :param df: A dataframe contains total investment and total value
    :param y1: Column name
    :param y2: Column name
    :param xlabel: X label
    :param ylabel: Y label
    :param title: Title of the graph
    :return: A plot
    """</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">y1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">y1</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">y2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">y2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'target value'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">y1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<h1 id="plan-1-yearly-dollar-cost-averaging-buying-method">Plan 1: Yearly <a href="https://en.wikipedia.org/wiki/Dollar_cost_averaging">dollar cost averaging</a> buying method</h1>

<p>Imagine we were able to invest 1200 dollar per year into a SP500 index based ETF starting from 1988.</p>

<p>Whatâ€™s the overall return after 32 years?</p>

<p>Whatâ€™s the average annual return?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df1</span> <span class="o">=</span> <span class="n">calc_dollar_cost_averaging_return</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value_per_period</span><span class="o">=</span><span class="mi">1200</span><span class="p">)</span>
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The overall return rate is 580.19%
The cash flow (the negative sign stands for investment):

[-1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 -1200.0,
 261192.11446741945]

The internal return rate (IRR) is 9.92% per period
The compound annual growth rate (CAGR) is 6.17% per period
</code></pre></div></div>

<p>df1:</p>

<div>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>Adj Close</th>
      <th>return_next_y</th>
      <th>should_invest</th>
      <th>total_invest</th>
      <th>total_value_next</th>
      <th>overall_return_next</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1988</td>
      <td>256.019989</td>
      <td>0.115733</td>
      <td>1200.0</td>
      <td>1200.0</td>
      <td>1338.879804</td>
      <td>0.115733</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1989</td>
      <td>285.649994</td>
      <td>0.351864</td>
      <td>1200.0</td>
      <td>2400.0</td>
      <td>3432.220743</td>
      <td>0.430092</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1990</td>
      <td>386.160004</td>
      <td>-0.058836</td>
      <td>1200.0</td>
      <td>3600.0</td>
      <td>4359.680708</td>
      <td>0.211022</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1991</td>
      <td>363.440002</td>
      <td>0.320273</td>
      <td>1200.0</td>
      <td>4800.0</td>
      <td>7340.295930</td>
      <td>0.529228</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1992</td>
      <td>479.839996</td>
      <td>0.075358</td>
      <td>1200.0</td>
      <td>6000.0</td>
      <td>9183.879488</td>
      <td>0.530647</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1993</td>
      <td>516.000000</td>
      <td>0.099031</td>
      <td>1200.0</td>
      <td>7200.0</td>
      <td>11412.205047</td>
      <td>0.585028</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1994</td>
      <td>567.099976</td>
      <td>0.014848</td>
      <td>1200.0</td>
      <td>8400.0</td>
      <td>12799.465363</td>
      <td>0.523746</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1995</td>
      <td>575.520020</td>
      <td>0.386954</td>
      <td>1200.0</td>
      <td>9600.0</td>
      <td>19416.618801</td>
      <td>1.022564</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1996</td>
      <td>798.219971</td>
      <td>0.214014</td>
      <td>1200.0</td>
      <td>10800.0</td>
      <td>25028.857872</td>
      <td>1.317487</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1997</td>
      <td>969.049988</td>
      <td>0.346721</td>
      <td>1200.0</td>
      <td>12000.0</td>
      <td>35322.955610</td>
      <td>1.943580</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1998</td>
      <td>1305.040039</td>
      <td>0.278520</td>
      <td>1200.0</td>
      <td>13200.0</td>
      <td>46695.335609</td>
      <td>2.537525</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1999</td>
      <td>1668.520020</td>
      <td>0.199932</td>
      <td>1200.0</td>
      <td>14400.0</td>
      <td>57471.129235</td>
      <td>2.991051</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2000</td>
      <td>2002.109985</td>
      <td>-0.108011</td>
      <td>1200.0</td>
      <td>15600.0</td>
      <td>52333.999013</td>
      <td>2.354744</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2001</td>
      <td>1785.859985</td>
      <td>-0.088109</td>
      <td>1200.0</td>
      <td>16800.0</td>
      <td>48817.182741</td>
      <td>1.905785</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2002</td>
      <td>1628.510010</td>
      <td>-0.199778</td>
      <td>1200.0</td>
      <td>18000.0</td>
      <td>40024.865577</td>
      <td>1.223604</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2003</td>
      <td>1303.170044</td>
      <td>0.241626</td>
      <td>1200.0</td>
      <td>19200.0</td>
      <td>51185.872534</td>
      <td>1.665931</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2004</td>
      <td>1618.050049</td>
      <td>0.103155</td>
      <td>1200.0</td>
      <td>20400.0</td>
      <td>57789.735898</td>
      <td>1.832830</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2005</td>
      <td>1784.959961</td>
      <td>0.075072</td>
      <td>1200.0</td>
      <td>21600.0</td>
      <td>63418.196358</td>
      <td>1.936028</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2006</td>
      <td>1918.959961</td>
      <td>0.138075</td>
      <td>1200.0</td>
      <td>22800.0</td>
      <td>73540.339150</td>
      <td>2.225453</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2007</td>
      <td>2183.919922</td>
      <td>0.040977</td>
      <td>1200.0</td>
      <td>24000.0</td>
      <td>77802.957039</td>
      <td>2.241790</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2008</td>
      <td>2273.409912</td>
      <td>-0.340563</td>
      <td>1200.0</td>
      <td>25200.0</td>
      <td>52097.453233</td>
      <td>1.067359</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2009</td>
      <td>1499.170044</td>
      <td>0.245396</td>
      <td>1200.0</td>
      <td>26400.0</td>
      <td>66376.423781</td>
      <td>1.514258</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2010</td>
      <td>1867.060059</td>
      <td>0.145277</td>
      <td>1200.0</td>
      <td>27600.0</td>
      <td>77393.691544</td>
      <td>1.804119</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2011</td>
      <td>2138.300049</td>
      <td>0.025300</td>
      <td>1200.0</td>
      <td>28800.0</td>
      <td>80582.143634</td>
      <td>1.797991</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2012</td>
      <td>2192.399902</td>
      <td>0.171570</td>
      <td>1200.0</td>
      <td>30000.0</td>
      <td>95813.509570</td>
      <td>2.193784</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2013</td>
      <td>2568.550049</td>
      <td>0.279590</td>
      <td>1200.0</td>
      <td>31200.0</td>
      <td>124137.478352</td>
      <td>2.978765</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2014</td>
      <td>3286.689941</td>
      <td>0.146649</td>
      <td>1200.0</td>
      <td>32400.0</td>
      <td>143718.101728</td>
      <td>3.435744</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2015</td>
      <td>3768.679932</td>
      <td>-0.001244</td>
      <td>1200.0</td>
      <td>33600.0</td>
      <td>144737.758102</td>
      <td>3.307671</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2016</td>
      <td>3763.989990</td>
      <td>0.146411</td>
      <td>1200.0</td>
      <td>34800.0</td>
      <td>167304.672506</td>
      <td>3.807606</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2017</td>
      <td>4315.080078</td>
      <td>0.218119</td>
      <td>1200.0</td>
      <td>36000.0</td>
      <td>205258.694569</td>
      <td>4.701630</td>
    </tr>
    <tr>
      <th>30</th>
      <td>2018</td>
      <td>5256.279785</td>
      <td>-0.050553</td>
      <td>1200.0</td>
      <td>37200.0</td>
      <td>196021.626888</td>
      <td>4.269399</td>
    </tr>
    <tr>
      <th>31</th>
      <td>2019</td>
      <td>4990.560059</td>
      <td>0.324358</td>
      <td>1200.0</td>
      <td>38400.0</td>
      <td>261192.114467</td>
      <td>5.801878</td>
    </tr>
    <tr>
      <th>32</th>
      <td>2020</td>
      <td>6609.290039</td>
      <td>NaN</td>
      <td>1200.0</td>
      <td>39600.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_changes</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">'Plan 1'</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">'year'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/3_output_14_0.png" alt="png" title="Plan 1" width="80%" /></p>

<h1 id="plan-2-increase-the-investment-each-year-by-2">Plan 2: Increase the investment each year by 2%</h1>
<p>In Plan 2, letâ€™s assume the initial_investment is 1200, and then we increase the investment each year by 2%.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Assuming initial_investment is 1200, and then increase investment each year by 2%
</span><span class="n">df2</span> <span class="o">=</span> <span class="n">calc_dollar_cost_averaging_return</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value_per_period</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">increase_investment_per_period</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
</code></pre></div></div>
<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The overall return rate is 486.51%
The cash flow (the negative sign stands for investment):
   
[-1200.0,
 -1224.0,
 -1248.48,
 -1273.4496000000001,
 -1298.918592,
 -1324.8969638400001,
 -1351.3949031168002,
 -1378.422801179136,
 -1405.991257202719,
 -1434.1110823467732,
 -1462.7933039937088,
 -1492.049170073583,
 -1521.8901534750546,
 -1552.327956544556,
 -1583.374515675447,
 -1615.042005988956,
 -1647.3428461087349,
 -1680.2897030309098,
 -1713.8954970915281,
 -1748.1734070333584,
 -1783.1368751740258,
 -1818.7996126775063,
 -1855.1756049310566,
 -1892.2791170296778,
 -1930.1246993702714,
 -1968.7271933576767,
 -2008.1017372248302,
 -2048.263771969327,
 -2089.2290474087135,
 -2131.0136283568877,
 -2173.633900924026,
 -2217.106578942506,
 311273.63335198513]

The internal return rate (IRR) is 9.91% per period
The compound annual growth rate (CAGR) is 5.68% per period
</code></pre></div></div>

<p>df2:</p>

<div>
<table>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>Adj Close</th>
      <th>return_next_y</th>
      <th>should_invest</th>
      <th>total_invest</th>
      <th>total_value_next</th>
      <th>overall_return_next</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1988</td>
      <td>256.019989</td>
      <td>0.115733</td>
      <td>1200.000000</td>
      <td>1200.000000</td>
      <td>1338.879804</td>
      <td>0.115733</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1989</td>
      <td>285.649994</td>
      <td>0.351864</td>
      <td>1224.000000</td>
      <td>2424.000000</td>
      <td>3464.665484</td>
      <td>0.429317</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1990</td>
      <td>386.160004</td>
      <td>-0.058836</td>
      <td>1248.480000</td>
      <td>3672.480000</td>
      <td>4435.844184</td>
      <td>0.207861</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1991</td>
      <td>363.440002</td>
      <td>0.320273</td>
      <td>1273.449600</td>
      <td>4945.929600</td>
      <td>7537.826024</td>
      <td>0.524046</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1992</td>
      <td>479.839996</td>
      <td>0.075358</td>
      <td>1298.918592</td>
      <td>6244.848192</td>
      <td>9502.668090</td>
      <td>0.521681</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1993</td>
      <td>516.000000</td>
      <td>0.099031</td>
      <td>1324.896964</td>
      <td>7569.745156</td>
      <td>11899.829221</td>
      <td>0.572025</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1994</td>
      <td>567.099976</td>
      <td>0.014848</td>
      <td>1351.394903</td>
      <td>8921.140059</td>
      <td>13447.972306</td>
      <td>0.507428</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1995</td>
      <td>575.520020</td>
      <td>0.386954</td>
      <td>1378.422801</td>
      <td>10299.562860</td>
      <td>20563.532573</td>
      <td>0.996544</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1996</td>
      <td>798.219971</td>
      <td>0.214014</td>
      <td>1405.991257</td>
      <td>11705.554117</td>
      <td>26671.303126</td>
      <td>1.278517</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1997</td>
      <td>969.049988</td>
      <td>0.346721</td>
      <td>1434.111082</td>
      <td>13139.665200</td>
      <td>37850.153571</td>
      <td>1.880603</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1998</td>
      <td>1305.040039</td>
      <td>0.278520</td>
      <td>1462.793304</td>
      <td>14602.458504</td>
      <td>50262.395731</td>
      <td>2.442050</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1999</td>
      <td>1668.520020</td>
      <td>0.199932</td>
      <td>1492.049170</td>
      <td>16094.507674</td>
      <td>62101.796628</td>
      <td>2.858571</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2000</td>
      <td>2002.109985</td>
      <td>-0.108011</td>
      <td>1521.890153</td>
      <td>17616.397827</td>
      <td>56751.625622</td>
      <td>2.221523</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2001</td>
      <td>1785.859985</td>
      <td>-0.088109</td>
      <td>1552.327957</td>
      <td>19168.725784</td>
      <td>53166.862347</td>
      <td>1.773625</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2002</td>
      <td>1628.510010</td>
      <td>-0.199778</td>
      <td>1583.374516</td>
      <td>20752.100299</td>
      <td>43812.361085</td>
      <td>1.111225</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2003</td>
      <td>1303.170044</td>
      <td>0.241626</td>
      <td>1615.042006</td>
      <td>22367.142305</td>
      <td>56403.853151</td>
      <td>1.521728</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2004</td>
      <td>1618.050049</td>
      <td>0.103155</td>
      <td>1647.342846</td>
      <td>24014.485152</td>
      <td>64039.465661</td>
      <td>1.666702</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2005</td>
      <td>1784.959961</td>
      <td>0.075072</td>
      <td>1680.289703</td>
      <td>25694.774855</td>
      <td>70653.449907</td>
      <td>1.749721</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2006</td>
      <td>1918.959961</td>
      <td>0.138075</td>
      <td>1713.895497</td>
      <td>27408.670352</td>
      <td>82359.450191</td>
      <td>2.004869</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2007</td>
      <td>2183.919922</td>
      <td>0.040977</td>
      <td>1748.173407</td>
      <td>29156.843759</td>
      <td>87554.082572</td>
      <td>2.002866</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2008</td>
      <td>2273.409912</td>
      <td>-0.340563</td>
      <td>1783.136875</td>
      <td>30939.980634</td>
      <td>58912.245650</td>
      <td>0.904082</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2009</td>
      <td>1499.170044</td>
      <td>0.245396</td>
      <td>1818.799613</td>
      <td>32758.780247</td>
      <td>75634.187986</td>
      <td>1.308822</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2010</td>
      <td>1867.060059</td>
      <td>0.145277</td>
      <td>1855.175605</td>
      <td>34613.955851</td>
      <td>88746.748765</td>
      <td>1.563901</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2011</td>
      <td>2138.300049</td>
      <td>0.025300</td>
      <td>1892.279117</td>
      <td>36506.234969</td>
      <td>92932.231838</td>
      <td>1.545654</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2012</td>
      <td>2192.399902</td>
      <td>0.171570</td>
      <td>1930.124699</td>
      <td>38436.359668</td>
      <td>111137.895169</td>
      <td>1.891478</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2013</td>
      <td>2568.550049</td>
      <td>0.279590</td>
      <td>1968.727193</td>
      <td>40405.086861</td>
      <td>144730.058188</td>
      <td>2.581976</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2014</td>
      <td>3286.689941</td>
      <td>0.146649</td>
      <td>2008.101737</td>
      <td>42413.188598</td>
      <td>168257.173136</td>
      <td>2.967096</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2015</td>
      <td>3768.679932</td>
      <td>-0.001244</td>
      <td>2048.263772</td>
      <td>44461.452370</td>
      <td>170093.499961</td>
      <td>2.825640</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2016</td>
      <td>3763.989990</td>
      <td>0.146411</td>
      <td>2089.229047</td>
      <td>46550.681418</td>
      <td>197392.199679</td>
      <td>3.240372</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2017</td>
      <td>4315.080078</td>
      <td>0.218119</td>
      <td>2131.013628</td>
      <td>48681.695046</td>
      <td>243042.959525</td>
      <td>3.992492</td>
    </tr>
    <tr>
      <th>30</th>
      <td>2018</td>
      <td>5256.279785</td>
      <td>-0.050553</td>
      <td>2173.633901</td>
      <td>50855.328947</td>
      <td>232820.204951</td>
      <td>3.578089</td>
    </tr>
    <tr>
      <th>31</th>
      <td>2019</td>
      <td>4990.560059</td>
      <td>0.324358</td>
      <td>2217.106579</td>
      <td>53072.435526</td>
      <td>311273.633352</td>
      <td>4.865072</td>
    </tr>
    <tr>
      <th>32</th>
      <td>2020</td>
      <td>6609.290039</td>
      <td>NaN</td>
      <td>2261.448711</td>
      <td>55333.884237</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_changes</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">'Plan 2'</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">'year'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/3_output_18_0.png" alt="png" title="Plan 2" width="80%" /></p>

<h1 id="conclusion">Conclusion</h1>

<p>The compound annual growth rate of Plan 2 is lower than that of Plan 1. This is because Plan 2 invested more money at the later stage of the investment. But, in both plans, the compound annual growth rates are more than 5%.</p>

<p>The internal return rate of both plans are quite similiar to each other (almost 10%).</p>

<p>It seems that SP500 is a good enough index that can bring us long term return. However, the historical data cannot predict the future. Please do your own research before investing.</p>

<p>In the next notebook, we will further discuss which strategy can further increase IRR.</p>


  </article>
</div>

<div class="share-buttons">
  <h6>Share on: </h6>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=https://RuoyunLin.github.io/articles/2020-09/financial-analysis-in-python-2-backtest-dollar-cost-averaging-strategy-for-long-term-investment" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://RuoyunLin.github.io/articles/2020-09/financial-analysis-in-python-2-backtest-dollar-cost-averaging-strategy-for-long-term-investment" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=https://RuoyunLin.github.io/articles/2020-09/financial-analysis-in-python-2-backtest-dollar-cost-averaging-strategy-for-long-term-investment" class="google-plus btn" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
    <li>
      <a href="https://news.ycombinator.com/submitlink?u=https://RuoyunLin.github.io/articles/2020-09/financial-analysis-in-python-2-backtest-dollar-cost-averaging-strategy-for-long-term-investment" class="hacker-news btn" title="Share on Hacker News"><i class="fa fa-hacker-news"></i><span> Hacker News</span></a>
    </li>
    <li>
      <a href="https://www.reddit.com/submit?url=https://RuoyunLin.github.io/articles/2020-09/financial-analysis-in-python-2-backtest-dollar-cost-averaging-strategy-for-long-term-investment" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
    </li>
  </ul>
</div><!-- end share-buttons -->



        <footer>
  &copy; 2022 Ruoyun Lin. Powered by <a href="http://octopress.org/">Octopress 3.0</a> and <a href="http://github.com/renyuanz/leonids/">Leonids theme</a>.
</footer>

      </div>
    </div>
  </div>
  <script type="text/javascript" src="https://RuoyunLin.github.io/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://RuoyunLin.github.io/js/main.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-141882286-1', 'auto');
  ga('send', 'pageview');
</script>



</body>
</html>
